<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formulario de contacto</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <h1>Registro</h1>

    <h2 id="alert"></h2>

    <form id="formulario">
      <h3>Nombres:</h3>
      <input
        type="text"
        id="nombre"
        name="nombre"
        placeholder="ingrese nombres..."
        required
      />

      <h3>Apellidos:</h3>
      <input
        type="text"
        id="apellidos"
        name="apellidos"
        placeholder="ingrese apellidos..."
        required
      />

      <h3>Tipo de documento:</h3>
      <select id="document">
        <option value="cedula">Cedula</option>
        <option value="cedula_extrangera">Cedula extrangera</option>
        <option value="targeta_identidad">targeta de identidad</option>
        <option value="pasaporte">Pasaporte</option>
        <option value="otro">Otro</option>
      </select>

      <h3>Numero de documento:</h3>
      <input
        type="number"
        id="ndd"
        name="Numero_documento"
        placeholder="58846317448"
        required
      />

      <h3>Genero:</h3>
      <select id="genero">
        <option value="hombre">Hombre</option>
        <option value="mujer">Mujer</option>
        <option value="otro">Otro</option>
      </select>

      <h3>Telefono:</h3>
      <input
        type="number"
        id="telefono"
        name="telefono"
        placeholder="3205687642"
        required
      />

      <h3>Correo:</h3>
      <input
        type="email"
        id="correo"
        name="correo"
        placeholder="ejemplo@gmail.com"
        required
      />

      <h3>Fecha de nacimiento:</h3>
      <input type="date" id="fecha" name="fecha" required />
    </form>

    <button class="button1" onclick="registar()">Registrar</button>

    <table class="tbl">
      <thead>
        <tr class="the">
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Tipo de documento</th>
          <th>Numero de documento</th>
          <th>Genero</th>
          <th>Telefono</th>
          <th>Correo</th>
          <th>Fecha de nacimiento</th>
          <th>Opciones</th>
        </tr>
      </thead>
      <tbody id="t">
        <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      </tbody>
    </table>

    <script>
      let arr = [];
      let op = null;
      let indice = null;

      let today = new Date();
      let dd = today.getDate();
      let mm = today.getMonth() + 1; //January is 0!
      let yyyy = today.getFullYear() - 18;

      if (dd < 10) {
        dd = "0" + dd;
      }

      if (mm < 10) {
        mm = "0" + mm;
      }

      today = yyyy + "-" + mm + "-" + dd;
      document.getElementById("fecha").setAttribute("max", today);

      function registar() {
        let nombre = document.getElementById("nombre").value;

        let apellidos = document.getElementById("apellidos").value;

        let tdd = document.getElementById("document").value;

        let ndd = document.getElementById("ndd").value;

        let genero = document.getElementById("genero").value;

        let telefono = document.getElementById("telefono").value;

        let correo = document.getElementById("correo").value;

        let fdn = document.getElementById("fecha").value;

        const rule = new RegExp("[a-z0-9._%+-]+@[a-z0-9.-]+\.com$");

        if (op === true) {
          if (document.getElementById("nombre").value === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un nombre, está vacio";
          } else if (document.getElementById("apellidos").value === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un apellido, está vacio";
          } else if (document.getElementById("document").value === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione su tipo de documento, está vacio";
          } else if (document.getElementById("ndd").value === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un numero de documento, está vacio";
          } else if (ndd.toString().length < 9) {
            document.getElementById(
              "alert"
            ).textContent = `Por favor ingrese un numero de documento con mas de 9 digitos, la contidad de digitos que ingreso son ${
              ndd.toString().length
            }`;
          } else if (document.getElementById("genero").value === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione una de las 3 opciones, está vacio";
          } else if (document.getElementById("telefono").value === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese su numero telefonico, está vacio";
          } else if (telefono.toString().length < 9) {
            document.getElementById(
              "alert"
            ).textContent = `Por favor ingrese un numero telefonico con mas de 9 digitos, la contidad de digitos que ingreso son ${
              telefono.toString().length
            }`; 
          } else if (document.getElementById("correo").value === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un correo, está vacio";
          } else if (!rule.test(correo)) {
            document.getElementById("alert").textContent =
              "Por favor ingrese correo valido (correo@dominio.com)";
          } else if (document.getElementById("fecha").value === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione su fecha de nacimiento, está vacio";
          } else {
            arr[indice].nombre = document.getElementById("nombre").value;
            arr[indice].apellidos = document.getElementById("apellidos").value;
            arr[indice].tdd = document.getElementById("document").value;
            arr[indice].numero_documento = document.getElementById("ndd").value;
            arr[indice].genero = document.getElementById("genero").value;
            arr[indice].telefono = document.getElementById("telefono").value;
            arr[indice].correo = document.getElementById("correo").value;
            arr[indice].fdn = document.getElementById("fecha").value;
            document.getElementById("formulario").reset();
            op = false;
          }
          setTimeout(() => {
            document.getElementById("alert").textContent = "";
          }, 5000);

          
        } else {
          if (nombre === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un nombre, está vacio";
          } else if (apellidos === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un apellido, está vacio";
          } else if (tdd === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione su tipo de documento, está vacio";
          } else if (ndd === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un numero de documento, está vacio";
          } else if (ndd.toString().length < 9) {
            document.getElementById(
              "alert"
            ).textContent = `Por favor ingrese un numero de documento con mas de 9 digitos, la contidad de digitos que ingreso son ${
              ndd.toString().length
            }`;
          } else if (genero === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione una de las 3 opciones, está vacio";
          } else if (telefono === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese su numero telefonico, está vacio";
          } else if (telefono.toString().length < 9) {
            document.getElementById(
              "alert"
            ).textContent = `Por favor ingrese un numero telefonico con mas de 9 digitos, la contidad de digitos que ingreso son ${
              telefono.toString().length
            }`;
          } else if (correo === "") {
            document.getElementById("alert").textContent =
              "Por favor ingrese un correo, está vacio";
          } else if (!rule.test(correo)) {
            document.getElementById("alert").textContent =
              "Por favor ingrese correo valido (correo@dominio.com)";
          } else if (fdn === "") {
            document.getElementById("alert").textContent =
              "Por favor seleccione su fecha de nacimiento, está vacio";
          } else {
            let usuario = {
              nombre: nombre,
              apellidos: apellidos,
              tipo_documento: tdd,
              numero_documento: ndd,
              genero: genero,
              telefono: telefono,
              correo: correo,
              fdn: fdn,
            };
            arr.push(usuario);

            document.getElementById("formulario").reset();
          }
          setTimeout(() => {
            document.getElementById("alert").textContent = "";
          }, 5000);
        }
        document.getElementById("t").innerHTML = "";
        console.log(arr);
        rellenar();
        
      }

      function rellenar() {
        let frag = document.createDocumentFragment();

        arr.forEach((item, index) => {
          let tr = document.createElement("tr");
          let td1 = document.createElement("td");
          let td2 = document.createElement("td");
          let td3 = document.createElement("td");
          let td4 = document.createElement("td");
          let td5 = document.createElement("td");
          let td6 = document.createElement("td");
          let td7 = document.createElement("td");
          let td8 = document.createElement("td");
          let td9 = document.createElement("td");
          let editar = document.createElement("button");
          let eliminar = document.createElement("button");
          editar.textContent = "✍️";
          editar.addEventListener("click", () => {
            edita(item, index);
          });
          eliminar.textContent = "🗑️";
          eliminar.addEventListener("click", () =>{
            elimina(index);
          });
          td1.textContent = item.nombre;
          td2.textContent = item.apellidos;
          td3.textContent = item.tipo_documento;
          td4.textContent = item.numero_documento;
          td5.textContent = item.genero;
          td6.textContent = item.telefono;
          td7.textContent = item.correo;
          td8.textContent = item.fdn;
          td9.appendChild(editar);
          td9.appendChild(eliminar);
          tr.appendChild(td1);
          tr.appendChild(td2);
          tr.appendChild(td3);
          tr.appendChild(td4);
          tr.appendChild(td5);
          tr.appendChild(td6);
          tr.appendChild(td7);
          tr.appendChild(td8);
          tr.appendChild(td9);
          frag.appendChild(tr);
          document.getElementById("t").appendChild(frag);
        });
      }

      function edita(r, i) {
        op = true;
        indice = i;
        console.log(r);

        document.getElementById("nombre").value = r.nombre;
        document.getElementById("apellidos").value = r.apellidos;
        document.getElementById("document").value = r.tipo_documento;
        document.getElementById("ndd").value = r.numero_documento;
        document.getElementById("genero").value = r.genero;
        document.getElementById("telefono").value = r.telefono;
        document.getElementById("correo").value = r.correo;
        document.getElementById("fecha").value = r.fdn;
      }

      function elimina(i) {
        index=i
        arr.splice(index, 1);
        document.getElementById("t").innerHTML = "";
        rellenar();
      }
      
    </script>
  </body>
</html>
